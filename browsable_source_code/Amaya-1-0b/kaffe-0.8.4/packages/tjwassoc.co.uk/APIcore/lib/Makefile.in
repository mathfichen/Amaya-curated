# Native support for standard Java libraries
#
# Copyright (c) 1996 T. J. Wilkinson & Associates, London, UK.
#
# See the file "license.terms" for information on usage and redistribution
# of this file, and for a DISCLAIMER OF ALL WARRANTIES.
#
# Written by Tim Wilkinson <tim@tjwassoc.demon.co.uk>, 1996.

@VPATHOPT@=	@srcdir@/java.io@VPATHSEP@@srcdir@/java.lang@VPATHSEP@@srcdir@/java.util@VPATHSEP@@srcdir@/java.io.stubs@VPATHSEP@@srcdir@/java.lang.stubs@VPATHSEP@@srcdir@/java.util.stubs
srcdir=		@srcdir@
prefix=		@prefix@
exec_prefix=	@exec_prefix@
libdir=		@libdir@
CC=		@CC@
LD=		@LD@
AR=		@AR@
RANLIB=		@RANLIB@
INCLUDES=	-I$(srcdir) -I../../../../include -I$(srcdir)/../../../../include -I../../../../config -I$(srcdir)/../../../../config
CFLAGS=		@CFLAGS@
ALL_CFLAGS=	$(CFLAGS) $(INCLUDES)
INSTALL=	@INSTALL@
INSTALL_DATA=	@INSTALL_DATA@
MKDIR=		@MKDIR@
LN=		@LN_S@
DLLTOOL=	@DLLTOOL@
PIC=		@PIC@
LDFLAGS=	@LIBSHARE@
LIBS=		@LIBS@
LDTAIL=		@LDTAIL@
KVER=		@KVER@
OBJEXT=		@OBJEXT@
LIBEXT=		@LIBEXT@

LIBNAME=	libkaffe_native
LIB=		$(LIBNAME)$(LIBEXT).$(KVER)
LLIB=		$(LIBNAME)$(LIBEXT)

OBJECT.IO=	FileDescriptorStub$(OBJEXT) \
		FileDescriptor$(OBJEXT) \
		FileInputStreamStub$(OBJEXT) \
		FileInputStream$(OBJEXT) \
		FileOutputStreamStub$(OBJEXT) \
		FileOutputStream$(OBJEXT) \
		FileStub$(OBJEXT) \
		File$(OBJEXT) \
		RandomAccessFileStub$(OBJEXT) \
		RandomAccessFile$(OBJEXT)

OBJECT.LANG=	ClassLoaderStub$(OBJEXT) \
		ClassLoader$(OBJEXT) \
		ClassStub$(OBJEXT) \
		Class$(OBJEXT) \
		Field$(OBJEXT) \
		CompilerStub$(OBJEXT) \
		Compiler$(OBJEXT) \
		DoubleStub$(OBJEXT) \
		Double$(OBJEXT) \
		FloatStub$(OBJEXT) \
		Float$(OBJEXT) \
		MathStub$(OBJEXT) \
		Math$(OBJEXT) \
		ObjectStub$(OBJEXT) \
		Object$(OBJEXT) \
		ProcessReaperStub$(OBJEXT) \
		ProcessReaper$(OBJEXT) \
		RuntimeStub$(OBJEXT) \
		Runtime$(OBJEXT) \
		SecurityManagerStub$(OBJEXT) \
		SecurityManager$(OBJEXT) \
		SystemStub$(OBJEXT) \
		System$(OBJEXT) \
		ThreadStub$(OBJEXT) \
		Thread$(OBJEXT) \
		ThrowableStub$(OBJEXT) \
		Throwable$(OBJEXT) \
		UNIXProcessStub$(OBJEXT) \
		UNIXProcess$(OBJEXT)

OBJECT.UTIL=	DateStub$(OBJEXT) \
		Date$(OBJEXT)

OBJECT=		$(OBJECT.LANG) $(OBJECT.IO) $(OBJECT.UTIL)

all:		$(LLIB)

$(LLIB):        $(LIB)
		rm -f $(LLIB)
		$(LN) $(LIB) $(LLIB)

$(LIB):		$(OBJECT) lib.exp
		@LINKLIB@

.c$(OBJEXT):
		$(CC) $(ALL_CFLAGS) -c $(PIC) $<

clean:
		rm -f $(LLIB) $(LIB) $(OBJECT) lib.exp

distclean:	clean
		rm -f Makefile

install:
		test -d $(libdir) || $(MKDIR) $(libdir)
		$(INSTALL_DATA) $(LIB) $(libdir)/$(LIB)
		rm -f $(libdir)/$(LLIB)
		$(LN) $(LIB) $(libdir)/$(LLIB)

lib.exp:
		$(DLLTOOL) --def $(srcdir)/$(LIBNAME).def --output-exp lib.exp --output-lib $(LIBNAME).a --dllname $(LLIB)
		touch lib.exp

# --------------------------------------------------------------------------
# Stuff to regenerate stubs

JAVALANG=	java.lang.Class java.lang.ClassLoader java.lang.Compiler \
		java.lang.Double java.lang.Float java.lang.Math \
		java.lang.Object java.lang.ProcessReaper java.lang.Runtime \
		java.lang.SecurityManager java.lang.System java.lang.Thread \
		java.lang.Throwable java.lang.UNIXProcess
JAVAIO=		java.io.File java.io.FileDescriptor java.io.FileInputStream \
		java.io.FileOutputStream java.io.RandomAccessFile
JAVAUTIL=	java.util.Date

stubs:
		(cd $(srcdir)/java.lang.stubs;\
			kaffeh -base $(JAVALANG);\
			kaffeh -postfix Stub -base -stubs $(JAVALANG))
		(cd $(srcdir)/java.io.stubs;\
			kaffeh -base $(JAVAIO)\
			java.io.PrintStream;\
			kaffeh -postfix Stub -base -stubs $(JAVAIO))
		(cd $(srcdir)/java.util.stubs;\
			kaffeh -base $(JAVAUTIL);\
			kaffeh -postfix Stub -base -stubs $(JAVAUTIL))
