<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>
Testbed</title>
</head>
<body bgcolor="#FFFFFF" lang="en">

<h2 align=right><b><a href="http://www.w3.org/"><img border="0" alt="W3C"
width="72" align=left height="48" src="http://www.w3.org/Icons/WWW/w3c_home">
 </a>NOTE-expamaya</b></h2>

<h1 align=center>Amaya Testbed Environments</h1>

<h1 align=center>The Java and ILU versions of Amaya</h1>

<h3 align=center>W3C NOTE 28-October-1997 (Broken markup fixed 23 March 2007)</h3>
<p>
<b>This document:</b> <a
href="http://www.w3.org/TR/NOTE-expamaya">http://www.w3.org/TR/NOTE-expamaya</a></p>
<p>
<b>Author:</b> <a
href="http://www.w3.org/People/W3CPeople.html#Veillard">Daniel Veillard</a>,
W3C, &lt;<a href="mailto:veillard@w3.org">veillard@w3.org</a>></p>
<p>
</p>
<hr>

<h2><a name="Status of This Document"></a>Status of This Document</h2>
<p>
This document is part of the <a href="http://www.w3.org/Amaya/Activity">Amaya
activity</a>. A list of current NOTEs can be found at: <a
href="http://www.w3.org/TR/">http://www.w3.org/TR/</a>. This NOTE will not be
maintained, so we kindly ask you to refer to the included URLs for the latest
information. The mailing-list <a
href="mailto:www-amaya@w3.org">www-amaya@w3.org</a> is also a good way to get
the latest informations on Amaya.</p>

<h3>Abstract</h3>
<p>
This note is written to explain (for example to members of the <a
href="http://www.w3.org/DOM/">DOM</a> and <a
href="http://www.w3.org/Protocols/HTTP-NG/">HTTP-NG</a> working groups) the
internal structure of the special versions of the <a
href="http://www.w3.org/Amaya/">Amaya</a> client which are provided as
testbeds including Java or <a
href="ftp://ftp.parc.xerox.com/pub/ilu/ilu.html">ILU</a>.</p>
<p>
A related note <a
href="http://www.w3.org/TR/NOTE-amaya-970220">NOTE-Amaya-970220</a> presents
Amaya, the W3C testbed client.</p>

<h3>Content</h3>
<ul class="TableOfContent">
<li>
<a href="#toc3">General description of Amaya</a>
<li>
<a href="#toc4">Embedding Java</a>
<li>
<a href="#toc5">Adding an ILU interface to Amaya</a>
<li>
<a href="#toc6">Amaya with Java and ILU</a>
<li>
<a href="#toc7">Further reading</a>
</ul>
<p>
</p>
<hr>

<h3><a name="toc3">General description of Amaya</a></h3>
<p>
<a href="http://www.w3.org/Amaya/">Amaya</a> is a Web client that acts both as
a browser and as an authoring tool. It has been designed with the primary
purpose of being a testbed for experimenting and demonstrating new
specifications and extensions of Web protocols and standards. Amaya is made of
three main software pieces:</p>
<ol>
<li>
The <a href="http://opera.inrialpes.fr/thot/">Thot</a> library was developed
at <a href="http://www.inria.fr/">Inria</a> by project <a
href="http://opera.inrialpes.fr/">Opera</a>. Thot offers a comprehensive
toolset for structured document manipulations.
<li>
An <a href="http://www.w3.org/Protocols/">HTTP</a> implementation offering the
interface needed to load and store document from remote servers.
<li>
The Amaya code itself which set up the graphic interface for the application,
handle the HTML document parsing,  render the document on screen and controls
the network accesses.
</ol>
<p>
</p>
<p>
The following picture describes this framework:</p>
<p>
<img src="expaLibWWW.gif" alt="Amaya framework"></p>
<p>
The <a href="http://opera.inrialpes.fr/thot/doc/APIman.toc.html">Thot API</a>
consists of approximately 260 functions allowing one to create, display and
modify structured documents. The Amaya API currently includes around 40
functions, mostly related to Amaya user interface and style sheet support, and
could probably be extended to provide more flexibility.</p>
<p>
Two extension have been made to this existing framework with the purpose of
helping building testbed with Amaya.</p>

<h3><a name="toc4">Embedding Java</a></h3>
<p>
The first one was to embed a <a href="http://www.javasoft.com/">Java</a>
interpreter in Amaya (the <a href="http://www.kaffe.org/">Kaffe</a> JIT Java
virtual machine). The resulting program contains both a standard C environment
where most of the actual Amaya application runs, and a Java Virtual Machine.
One of the main changes concerning Amaya in this environment is the use of the
Jigsaw (the W3C HTTP server and proxy) HTTP code for network accesses instead
of libWWW. Using the Jigsaw API it is easy to customize the HTTP behaviour
like adding filters to HTTP requests or using an advanced proxy scheme.</p>
<p>
A set of stubs gives access to all the interfaces of the Thot and Amaya APIs
from the Java environment. This allow code written in Java to modify the
documents content or control it's presentation. One of the possible use of
these functionalities is to build a <a href="http://www.w3.org/DOM/">DOM</a>
(Document Object Model) testbed written in Java and taking full advantage of
the structured document model offered by Thot toolkit.</p>
<p>
Here is the picture describing the Amaya-Java framework:<img
src="expaJigsaw.gif" alt="Amaya-Java framework"></p>
<p>
Most of the stubs used to make the interface between Java environment and the
C runtime are automatically generated from the public C interfaces headers. A
small set of  Java classes have been built on top of the raw native interface
to encapsulate it and provide an object-oriented metaphor for the object types
commonly used in the Thot library. This version of Amaya is distributed since
June 97 along with the standard one under the name amaya-java. One of the main
limitation of Java support in Amaya it the unreliability of AWT support in
Kaffe. Kaffe doesn't use the Java AWT classes and relies on the <a
href="http://www.biss-net.com/biss-awt.html">Biss classes</a> emulating AWT,
the emulation is nor perfect and the support for the Biss classes has been
removed in the latest version (should reappear soon).</p>

<h3><a name="toc5">Adding an ILU interface to Amaya</a></h3>
<p>
Another extension - nearly completed but not yet distributed - is to add <a
href="ftp://ftp.parc.xerox.com/pub/ilu/ilu.html">ILU</a> (Inter Language
Unification) to Amaya. It allows to access remotely to a set of interfaces
exported from Amaya through ILU. This allows for example another program
running remotely or on the same machine to access the Amaya core
functionalities. The interfaces are defined in  ILU's Interface Specification
Language (ISL) and can be accessed from a large set of languages. ILU also
offers various transport layers (RPC's, HTTP, ...) and can be used as a a
CORBA ORB system.</p>
<p>
The first ILU-Amaya prototype actually uses ILU HTTP implementation to fetch
Amaya pages. Currently the support for the loading of inlined object is not
ready, but this will hopefully be fixed soon. This picture shows the
architecture of this first prototype:</p>
<p>
</p>
<p>
<img src="expaILU.gif" alt="ILU-Amaya prototype"></p>
<p>
Using the Amaya API exported by this version of ILU, it is extremely simple to
build add-on packages able to run remotely and which affect the behaviour of
Amaya. For example building a client programs which force Amaya to load a
specific URL takes a few lines of C code (mostly initialization stuff). Due to
ILU support for a large number of language such client could be either built
with Java, Python, C++, Modula, etc ...</p>
<p>
Like for the Java integration, the stubs are automatically generated from
Amaya C header files, a first stub generator produce the ISL definition and a
C module used for ILU front-end. Then the ILU stub generator is invoked on the
ISL file to build the server and client modules needed:</p>
<p>
<img src="expaStubs.gif" alt="stubs generation"></p>
<p>
Using a stubber for another language on the ISL file alllows to build the glue
needed to interface it with Amaya exported interfaces.</p>

<h3><a name="toc6">Amaya with Java and ILU</a></h3>
<p>
This last testbed version includes both the Java runtime and the ILU stubs.
The HTTP accesses are done using the Jigsaw client code. It basically offers
both the Java ILU interfaces to the core of Amaya:</p>
<p>
<img src="expaJavaAndILU.gif" alt="Amaya with Java and ILU"></p>
<p>
Since this testbed is using the Jigsaw HTTP interface for fetching pages and
inlined objects, it doesn't suffers from the same problems of the pure ILU
version. The ILU interfaces also offers the ILU HTTP stack for remote API
accesses.</p>

<h2><a name="toc7">Further reading</a></h2>
<p>
The following documents are available on the web:</p>
<ul>
<li>
The <a href="http://opera.inrialpes.fr/thot/doc/APIman.toc.html">Thot API</a>
<li>
Xerox <a href="ftp://ftp.parc.xerox.com/pub/ilu/ilu.html">ILU</a>
(Inter-Language Unification)
<li>
<a href="http://www.kaffe.org/">Kaffe</a>, A free virtual machine to run
Java<sup>(tm)</sup> code
<li>
<a href="http://www.w3.org/DOM/">DOM</a>, the Document Object Model
<li>
How to <a href="http://www.w3.org/pub/WWW/Amaya/User/AmayaArchi.html">modify
or extend Amaya</a>
<li>
Specification of <a
href="http://opera.inrialpes.fr/thot/doc/languages.html">Thot languages</a>
(S: structure, P: presentation, T: translation)
<li>
How to <a href="http://www.w3.org/pub/WWW/Amaya/User/SourceDist.html">download
the source code</a>
<li>
and <a href="http://www.w3.org/pub/WWW/Amaya/User/">more</a>...
</ul>
<p>
</p>
<script src="https://www.w3.org/scripts/TR/fixup.js"></script></body>
</html>
